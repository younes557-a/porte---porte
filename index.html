<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Porte-à-porte — Login test</title>
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Inter,Arial;background:#fff;color:#111;margin:0}
  .wrap{max-width:760px;margin:40px auto;padding:16px}
  .card{background:#fff;border:1.5px solid #111;border-radius:14px;padding:14px}
  .row{display:flex;gap:8px;align-items:flex-end;flex-wrap:wrap}
  .input,button{border:1.5px solid #111;border-radius:10px;padding:8px 10px}
  button{background:#2563eb;color:#fff;border-color:#2563eb;cursor:pointer}
  .muted{color:#555}
  pre{background:#111;color:#0f0;padding:10px;border-radius:8px;white-space:pre-wrap}
</style>
</head>
<body>
<div class="wrap">
  <h1>Connexion — Supabase (test)</h1>
  <p class="muted">Si ça marche ici, l’auth de ton projet est correcte.</p>

  <div id="authCard" class="card">
    <div class="row">
      <div>
        <div class="muted">Email</div>
        <input id="email" class="input" placeholder="benevole@asso.fr" />
      </div>
      <div>
        <div class="muted">Mot de passe</div>
        <input id="password" type="password" class="input" placeholder="••••••••" />
      </div>
      <button id="btnSignIn">Se connecter</button>
      <button id="btnSignOut" style="background:#fff;color:#111;border-color:#111">Se déconnecter</button>
    </div>
    <div id="err" class="muted" style="margin-top:8px;color:#b91c1c"></div>
  </div>

  <div id="okCard" class="card" style="margin-top:12px;display:none">
    <b>Session active :</b> <span id="who"></span>
  </div>

  <h3>Logs</h3>
  <pre id="log"></pre>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

// === CONFIG: ton projet ===
const SUPABASE_URL  = 'https://ybzwaemympmesdttyvqi.supabase.co';
const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InliendhZW15bXBtZXNkdHR5dnFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4NDI3MjcsImV4cCI6MjA3MzQxODcyN30.MfFsFmpxYGWp-PIR4TXYKjXqOZY0On1r3Y0QUvqNkTc';
const supabase = createClient(SUPABASE_URL, SUPABASE_ANON, { auth: { persistSession: true } });

// === helpers DOM / log ===
const $ = (id)=>document.getElementById(id);
const log = (...a)=>{ $('log').textContent += a.map(x => typeof x==='string'? x : JSON.stringify(x,null,2)).join(' ') + '\n'; console.log(...a); };

// === affichage selon session ===
async function show(){
  const { data:{session}, error } = await supabase.auth.getSession();
  log('[getSession]', session ? '(OK)' : '(none)', error||'');
  if (session?.user){
    $('authCard').style.display = 'none';
    $('okCard').style.display   = 'block';
    $('who').textContent = session.user.email || session.user.id;
  } else {
    $('okCard').style.display   = 'none';
    $('authCard').style.display = 'block';
  }
}

// === actions ===
$('btnSignIn').onclick = async ()=>{
  $('err').textContent = '';
  const email = $('email').value.trim().toLowerCase();
  const password = $('password').value.trim();
  log('[login click]', {email, passwordLen: password.length});
  if(!email || !password){ $('err').textContent = 'Saisis email et mot de passe.'; return; }
  const { data, error } = await supabase.auth.signInWithPassword({ email, password });
  if (error){ $('err').textContent = error.message; log('[login ERROR]', error); return; }
  log('[login OK]', data?.user?.email||data?.user?.id);
  await show();
};
$('btnSignOut').onclick = async ()=>{
  await supabase.auth.signOut();
  log('[signOut] done');
  await show();
};

// === écouteur global (si la session change) ===
supabase.auth.onAuthStateChange((evt, session)=>{ log('[auth change]', evt, !!session); show(); });

// === démarrage ===
await show();
</script>
</body>
</html>



